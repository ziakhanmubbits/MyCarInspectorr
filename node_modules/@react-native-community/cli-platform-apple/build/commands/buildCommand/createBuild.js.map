{"version":3,"names":["createBuild","platformName","_","ctx","args","platformConfig","project","undefined","supportedPlatforms","CLIError","installedPods","automaticPodsInstallation","forcePods","onlyPods","isAppRunningNewArchitecture","sourceDir","getArchitecture","resolvePods","root","dependencies","reactNativePath","forceInstall","newArchEnabled","xcodeProject","getXcodeProjectAndDir","process","chdir","scheme","mode","getConfiguration","buildProject"],"sources":["../../../src/commands/buildCommand/createBuild.ts"],"sourcesContent":["import {CLIError} from '@react-native-community/cli-tools';\nimport {Config, IOSProjectConfig} from '@react-native-community/cli-types';\nimport getArchitecture from '../../tools/getArchitecture';\nimport {BuildFlags} from './buildOptions';\nimport {buildProject} from './buildProject';\nimport {getConfiguration} from './getConfiguration';\nimport {getXcodeProjectAndDir} from './getXcodeProjectAndDir';\nimport {BuilderCommand} from '../../types';\nimport {\n  supportedPlatforms,\n  resolvePods,\n} from '@react-native-community/cli-config-apple';\n\nconst createBuild =\n  ({platformName}: BuilderCommand) =>\n  async (_: Array<string>, ctx: Config, args: BuildFlags) => {\n    const platformConfig = ctx.project[platformName] as IOSProjectConfig;\n\n    if (\n      platformConfig === undefined ||\n      supportedPlatforms[platformName] === undefined\n    ) {\n      throw new CLIError(`Unable to find ${platformName} platform config`);\n    }\n\n    let installedPods = false;\n    if (\n      platformConfig.automaticPodsInstallation ||\n      args.forcePods ||\n      args.onlyPods\n    ) {\n      const isAppRunningNewArchitecture = platformConfig.sourceDir\n        ? await getArchitecture(platformConfig.sourceDir)\n        : undefined;\n\n      await resolvePods(\n        ctx.root,\n        platformConfig.sourceDir,\n        ctx.dependencies,\n        platformName,\n        ctx.reactNativePath,\n        {\n          forceInstall: args.forcePods || args.onlyPods,\n          newArchEnabled: isAppRunningNewArchitecture,\n        },\n      );\n\n      installedPods = true;\n    }\n\n    if (args.onlyPods) {\n      return;\n    }\n\n    let {xcodeProject, sourceDir} = getXcodeProjectAndDir(\n      platformConfig,\n      platformName,\n      installedPods,\n    );\n\n    process.chdir(sourceDir);\n\n    const {scheme, mode} = await getConfiguration(\n      xcodeProject,\n      sourceDir,\n      args,\n      platformName,\n    );\n\n    return buildProject(\n      xcodeProject,\n      platformName,\n      undefined,\n      mode,\n      scheme,\n      args,\n    );\n  };\n\nexport default createBuild;\n"],"mappings":";;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;AAEA;AACA;AACA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAGkD;AAElD,MAAMA,WAAW,GACf,CAAC;EAACC;AAA4B,CAAC,KAC/B,OAAOC,CAAgB,EAAEC,GAAW,EAAEC,IAAgB,KAAK;EACzD,MAAMC,cAAc,GAAGF,GAAG,CAACG,OAAO,CAACL,YAAY,CAAqB;EAEpE,IACEI,cAAc,KAAKE,SAAS,IAC5BC,oCAAkB,CAACP,YAAY,CAAC,KAAKM,SAAS,EAC9C;IACA,MAAM,KAAIE,oBAAQ,EAAE,kBAAiBR,YAAa,kBAAiB,CAAC;EACtE;EAEA,IAAIS,aAAa,GAAG,KAAK;EACzB,IACEL,cAAc,CAACM,yBAAyB,IACxCP,IAAI,CAACQ,SAAS,IACdR,IAAI,CAACS,QAAQ,EACb;IACA,MAAMC,2BAA2B,GAAGT,cAAc,CAACU,SAAS,GACxD,MAAM,IAAAC,wBAAe,EAACX,cAAc,CAACU,SAAS,CAAC,GAC/CR,SAAS;IAEb,MAAM,IAAAU,6BAAW,EACfd,GAAG,CAACe,IAAI,EACRb,cAAc,CAACU,SAAS,EACxBZ,GAAG,CAACgB,YAAY,EAChBlB,YAAY,EACZE,GAAG,CAACiB,eAAe,EACnB;MACEC,YAAY,EAAEjB,IAAI,CAACQ,SAAS,IAAIR,IAAI,CAACS,QAAQ;MAC7CS,cAAc,EAAER;IAClB,CAAC,CACF;IAEDJ,aAAa,GAAG,IAAI;EACtB;EAEA,IAAIN,IAAI,CAACS,QAAQ,EAAE;IACjB;EACF;EAEA,IAAI;IAACU,YAAY;IAAER;EAAS,CAAC,GAAG,IAAAS,4CAAqB,EACnDnB,cAAc,EACdJ,YAAY,EACZS,aAAa,CACd;EAEDe,OAAO,CAACC,KAAK,CAACX,SAAS,CAAC;EAExB,MAAM;IAACY,MAAM;IAAEC;EAAI,CAAC,GAAG,MAAM,IAAAC,kCAAgB,EAC3CN,YAAY,EACZR,SAAS,EACTX,IAAI,EACJH,YAAY,CACb;EAED,OAAO,IAAA6B,0BAAY,EACjBP,YAAY,EACZtB,YAAY,EACZM,SAAS,EACTqB,IAAI,EACJD,MAAM,EACNvB,IAAI,CACL;AACH,CAAC;AAAC,eAEWJ,WAAW;AAAA"}